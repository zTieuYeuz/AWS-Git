<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.131.0">
    <meta name="description" content="">
<meta name="author" content="journeyoftheaverageguy@gmail.com">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Tạo tunnel IPsec :: AWS System Manager</title>

    
    <link href="/css/nucleus.css?1724598897" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1724598897" rel="stylesheet">
    <link href="/css/hybrid.css?1724598897" rel="stylesheet">
    <link href="/css/featherlight.min.css?1724598897" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1724598897" rel="stylesheet">
    <link href="/css/auto-complete.css?1724598897" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1724598897" rel="stylesheet">
    <link href="/css/theme.css?1724598897" rel="stylesheet">
    <link href="/css/hugo-theme.css?1724598897" rel="stylesheet">
    
    <link href="/css/theme-workshop.css?1724598897" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1724598897"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/3-configvpnonaws/3.8-c%E1%BA%A5u-h%C3%ACnh-site-to-site-on-fortogate/3.8.1-t%E1%BA%A1o-tunnel-ipsec/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">

    <svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 160 80" width="60%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>Tran-Minh-Thoai</title><text x="5" y="40" class="cls-1" font-size="20" fill="#fff">Tran Minh Thoai</text></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1724598897"></script>
<script type="text/javascript" src="/js/auto-complete.js?1724598897"></script>
<script type="text/javascript">
    
        var baseurl = "\/\/localhost:1313\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1724598897"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/1-introduce/" title="Introduction" class="dd-item 
        
        
        
        ">
      <a href="/1-introduce/">
           <b> 1. </b> Introduction
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/2-prerequiste/" title="Accounting" class="dd-item 
        
        
        
        ">
      <a href="/2-prerequiste/">
           <b> 2. </b> Accounting
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/2-prerequiste/2.1-createvpc_ec2/" title="MFA-Alias" class="dd-item 
        
        
        
        ">
      <a href="/2-prerequiste/2.1-createvpc_ec2/">
           <b> 2.1 </b> MFA-Alias
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/2-prerequiste/2.1-createvpc_ec2/2.1.1-mfa/" title="MFA" class="dd-item 
        
        
        
        ">
      <a href="/2-prerequiste/2.1-createvpc_ec2/2.1.1-mfa/">
           <b> 2.1.1 </b> MFA
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-prerequiste/2.1-createvpc_ec2/2.1.2-alias/" title="Alias" class="dd-item 
        
        
        
        ">
      <a href="/2-prerequiste/2.1-createvpc_ec2/2.1.2-alias/">
           <b> 2.1.2 </b> Alias
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-prerequiste/2.2-createiamrole/" title="Create user Group" class="dd-item 
        
        
        
        ">
      <a href="/2-prerequiste/2.2-createiamrole/">
           <b> 2.2 </b> Create user Group
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-prerequiste/2.4-enablelogssm/" title="Budgets" class="dd-item 
        
        
        
        ">
      <a href="/2-prerequiste/2.4-enablelogssm/">
           <b> 2.4 </b> Budgets
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-prerequiste/2.3-createloggroup/2.3.1-role/" title="Role AWS" class="dd-item 
        
        
        
        ">
      <a href="/2-prerequiste/2.3-createloggroup/2.3.1-role/">
           <b> 2.3.1 </b> Role AWS
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/3-configvpnonaws/" title="VPN Site to Site" class="dd-item 
        parent
        
        
        ">
      <a href="/3-configvpnonaws/">
           <b> 3 </b> VPN Site to Site
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/3-configvpnonaws/3.1-introduce-site-to-site/" title="Introdue VPN Site To Site" class="dd-item 
        
        
        
        ">
      <a href="/3-configvpnonaws/3.1-introduce-site-to-site/">
           <b> 3.1 </b> Introdue VPN Site To Site
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-configvpnonaws/3.2-prerequiste/" title="Prerequiste" class="dd-item 
        
        
        
        ">
      <a href="/3-configvpnonaws/3.2-prerequiste/">
           <b> 3.2 </b> Prerequiste
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-configvpnonaws/3.3-chu%E1%BA%A9n-b%E1%BB%8B-vpc-v%C3%A0-ec2-instance/" title="Chuẩn bị VPC và EC2 Instance" class="dd-item 
        
        
        
        ">
      <a href="/3-configvpnonaws/3.3-chu%E1%BA%A9n-b%E1%BB%8B-vpc-v%C3%A0-ec2-instance/">
           <b> 3.3 </b> Chuẩn bị VPC và EC2 Instance
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-configvpnonaws/3.4-ta%CC%A3o-iam-role/" title="Create IAM Role" class="dd-item 
        
        
        
        ">
      <a href="/3-configvpnonaws/3.4-ta%CC%A3o-iam-role/">
           <b> 3.4 </b> Create IAM Role
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-configvpnonaws/3.5-create-loggroup-cloudwatch/" title="Create Cloudwatch" class="dd-item 
        
        
        
        ">
      <a href="/3-configvpnonaws/3.5-create-loggroup-cloudwatch/">
           <b> 3.5 </b> Create Cloudwatch
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-configvpnonaws/3.6-chu%E1%BA%A9n-b%E1%BB%8B-thi%E1%BA%BFt-bi-fortigate/" title="Firewall-Fortigate" class="dd-item 
        
        
        
        ">
      <a href="/3-configvpnonaws/3.6-chu%E1%BA%A9n-b%E1%BB%8B-thi%E1%BA%BFt-bi-fortigate/">
           <b> 3.6 </b> Firewall-Fortigate
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-configvpnonaws/3.7-c%E1%BA%A5u-h%C3%ACnh-site-to-site-tr%C3%AAn-aws/" title="Site to Site on AWS" class="dd-item 
        
        
        
        ">
      <a href="/3-configvpnonaws/3.7-c%E1%BA%A5u-h%C3%ACnh-site-to-site-tr%C3%AAn-aws/">
           <b> 3.7 </b> Site to Site on AWS
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/3-configvpnonaws/3.7-c%E1%BA%A5u-h%C3%ACnh-site-to-site-tr%C3%AAn-aws/3.7.1-virtual-private-gateway/" title="Tạo Virtual Private Gateway" class="dd-item 
        
        
        
        ">
      <a href="/3-configvpnonaws/3.7-c%E1%BA%A5u-h%C3%ACnh-site-to-site-tr%C3%AAn-aws/3.7.1-virtual-private-gateway/">
           <b> 3.7.1 </b> Tạo Virtual Private Gateway
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-configvpnonaws/3.7-c%E1%BA%A5u-h%C3%ACnh-site-to-site-tr%C3%AAn-aws/3.7.2-t%E1%BA%A1o-customer-gateway/" title="Tạo Customer Gateway" class="dd-item 
        
        
        
        ">
      <a href="/3-configvpnonaws/3.7-c%E1%BA%A5u-h%C3%ACnh-site-to-site-tr%C3%AAn-aws/3.7.2-t%E1%BA%A1o-customer-gateway/">
           <b> 3.7.2 </b> Tạo Customer Gateway
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-configvpnonaws/3.7-c%E1%BA%A5u-h%C3%ACnh-site-to-site-tr%C3%AAn-aws/3.7.3-t%E1%BA%A1o-k%E1%BA%BFt-n%E1%BB%91i-vpn/" title="Tạo kết nối VPN" class="dd-item 
        
        
        
        ">
      <a href="/3-configvpnonaws/3.7-c%E1%BA%A5u-h%C3%ACnh-site-to-site-tr%C3%AAn-aws/3.7.3-t%E1%BA%A1o-k%E1%BA%BFt-n%E1%BB%91i-vpn/">
           <b> 3.7.3 </b> Tạo kết nối VPN
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-configvpnonaws/3.8-c%E1%BA%A5u-h%C3%ACnh-site-to-site-on-fortogate/" title="Cấu hình S2S fortigate" class="dd-item 
        parent
        
        
        ">
      <a href="/3-configvpnonaws/3.8-c%E1%BA%A5u-h%C3%ACnh-site-to-site-on-fortogate/">
           <b> 3.8 </b> Cấu hình S2S fortigate
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/3-configvpnonaws/3.8-c%E1%BA%A5u-h%C3%ACnh-site-to-site-on-fortogate/3.8.1-t%E1%BA%A1o-tunnel-ipsec/" title="Tạo tunnel IPsec" class="dd-item 
        
        active
        
        ">
      <a href="/3-configvpnonaws/3.8-c%E1%BA%A5u-h%C3%ACnh-site-to-site-on-fortogate/3.8.1-t%E1%BA%A1o-tunnel-ipsec/">
           <b> 3.8.1 </b> Tạo tunnel IPsec
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-configvpnonaws/3.8-c%E1%BA%A5u-h%C3%ACnh-site-to-site-on-fortogate/3.8.2-ki%E1%BB%83m-tra-vpn/" title="Dọn dẹp tài nguyên" class="dd-item 
        
        
        
        ">
      <a href="/3-configvpnonaws/3.8-c%E1%BA%A5u-h%C3%ACnh-site-to-site-on-fortogate/3.8.2-ki%E1%BB%83m-tra-vpn/">
           <b> 3.8.2 </b> Dọn dẹp tài nguyên
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/4-configvpnonfortigate/" title="MinhThoai-Chưaxong" class="dd-item 
        
        
        
        ">
      <a href="/4-configvpnonfortigate/">
           <b> 4 </b> MinhThoai-Chưaxong
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/awsstudygroupfcj/"><i class='fab fa-facebook'></i> AWS Study Group</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="//localhost:1313/3-configvpnonaws/3.8-c%E1%BA%A5u-h%C3%ACnh-site-to-site-on-fortogate/3.8.1-t%E1%BA%A1o-tunnel-ipsec/" selected>English</option>
                    
                  
              
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
    
     <b> Workshop</b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title="Migrate" Alt="web counter"   border="0" /></a>  <br>
     <b> <a href="https://cloudjourney.awsstudygroup.com/">Cloud Journey</a></b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" Alt="web counter"   border="0"   />
     
</left>
<left>
    <br>
    <br>
        <b> Last Updated </b> <br>
        <i><font color=orange>06-08-2024</font></i>
    </left>
    <left>
        <br>
        <br>
            <b> Team </b> <br>
           
            <i> <a href="https://www.linkedin.com/in/sutrinh/"  style="color:orange">Sử Trịnh  </a> <br>
                <a href="https://www.linkedin.com/in/jotaguy"  style="color:orange">Gia Hưng </a> <br>
                <a href="https://www.linkedin.com/in/hiepnguyendt"  style="color:orange">Thanh Hiệp </a>
               
        </i>
        </left>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            
            
          
          
            <a href='/'>Session Management</a> > <a href='/3-configvpnonaws/'>VPN Site to Site</a> > <a href='/3-configvpnonaws/3.8-c%E1%BA%A5u-h%C3%ACnh-site-to-site-on-fortogate/'>Cấu hình S2S fortigate</a> > Tạo tunnel IPsec
          
        
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#chèn-hình">chèn hình</a></li>
    <li><a href="#chèn-hình-1">chèn hình</a></li>
    <li><a href="#chèn-hình-2">chèn hình</a></li>
    <li><a href="#chen-hình">chen hình</a>
      <ul>
        <li></li>
      </ul>
    </li>
    <li><a href="#chen-hình-1">chen hình</a>
      <ul>
        <li></li>
      </ul>
    </li>
    <li><a href="#chèn-hình-3">chèn hình</a></li>
    <li><a href="#chèn-hình-4">chèn hình</a></li>
    <li><a href="#chèn-hình-5">chèn hình</a></li>
    <li><a href="#chèn-hình-6">chèn hình</a></li>
    <li><a href="#chèn-hình-7">chèn hình</a></li>
    <li><a href="#chèn-hình-8">chèn hình</a></li>
    <li><a href="#chèn-hình-9">chèn hình</a></li>
    <li><a href="#chèn-hình-10">chèn hình</a></li>
    <li><a href="#chèn-hình-11">chèn hình</a></li>
    <li><a href="#chèn-hình-12">chèn hình</a></li>
    <li><a href="#chèn-hình-13">chèn hình</a></li>
    <li><a href="#chèn-hình-14">chèn hình</a></li>
    <li><a href="#chèn-hình-15">chèn hình</a></li>
    <li><a href="#chèn-hình-16">chèn hình</a></li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Tạo tunnel IPsec
            </h1>
          

        



	<ol>
<li>Truy cập vào VPC
<ul>
<li>Chọn Site-to-Site VPN Connection</li>
<li>Chọn VPN Connection đã tạo</li>
<li>Chọn Download Configuration</li>
</ul>
</li>
</ol>
<h2 id="chèn-hình">chèn hình</h2>
<ol start="2">
<li>Trong hộp thoại Download Configuration, lựa chọn appliance phù hợp với bạn: Trong bài thực hành này, chúng ta sẽ sử dụng Fortigate.
<ul>
<li>Vendor: Chọn Fortinet</li>
<li>Platform: Chọn Fortigate 40+series</li>
<li>Software: Chọn FortiOS 6.4.4+ (GUI)</li>
<li>IKE version: Chọn ikev1</li>
<li>Chọn Download.</li>
</ul>
</li>
</ol>
<h2 id="chèn-hình-1">chèn hình</h2>
<ol start="3">
<li>Lưu thông tin file câu hình vào thư mục:
<ul>
<li>Sau đó dựa vào cấu hình được cung cấp, bạn cấu hình các thông tin này cấu cho thiết bị của mình.</li>
</ul>
</li>
</ol>
<h2 id="chèn-hình-2">chèn hình</h2>
<p>Lưu ý ở bước về sau ta sẽ cấu hình các thông số này ở thiết bị firewall lần lượt theo thứ tự sau:</p>
<ul>
<li>Cấu hình Phase 1 cho Ip sec tunnel1</li>
<li>Cấu hình Phase 2 cho Ipsec Tunnel1</li>
<li>Cấu hình interface tunnel</li>
<li>Cấu hình routing BGP</li>
<li>Cấu hình Policy cho phép AWS và local DC giao tiếp được với nhau</li>
<li>Lặp từ bước 1 đến 5 cho</li>
</ul>
<ol start="4">
<li>Tại giao diện Fortigate tạo tunnel 1 VPN:
<ul>
<li>Chọn VPN -&gt; IPsec Wizard</li>
<li>Template type chọn Custom</li>
<li>Name nhập VPN AWS Tunnel 1</li>
<li>Chọn Next</li>
</ul>
</li>
</ol>
<h2 id="chen-hình">chen hình</h2>
<ol start="5">
<li>Tại giao diện New VPN Tunnel bạn tạo tunnel 1 cho VPN :</li>
</ol>
<h4 id="51-phase-1"><em><strong>5.1 Phase 1</strong></em></h4>
<ul>
<li>IP address nhập 18.143.226.251</li>
<li>Interface chọn Wan Internet(Wan 1)</li>
<li>NAT Traversal chọn Disable</li>
<li>Pre-shared Key nhập thông số như trong file DS6CXQf8YMvA0E4wRo4uDGRtcVofGiad</li>
<li>Phase 1 Proposal bạn xóa hết các dòng trước đó và cấu hình Encryption chọn AES128, Authentication chọn SHA1</li>
<li>Diffie-Hellman Groups bỏ chọn 14,5 . Chỉ chọn 2</li>
<li>Key Lifetime (seconds) nhập 28800</li>
</ul>
<h2 id="chen-hình-1">chen hình</h2>
<h4 id="52-phase-2"><em><strong>5.2 phase 2</strong></em></h4>
<ul>
<li>Phase 2 Selectors Chọn Vùng Phase2</li>
<li>Phase 2 Proposal xóa toàn bộ các dòng trước đó và cấu hình Encryption chọn</li>
<li>Diffie-Hellman Groups bỏ chọn 14,5 . Chỉ chọn 2</li>
<li>Chọn Auto-negotiate</li>
<li>Seconds nhập 3600</li>
<li>Chọn OK để tạo</li>
</ul>
<h2 id="chèn-hình-3">chèn hình</h2>
<ol start="6">
<li>Tại giao diện New VPN Tunnel bạn làm tương tự cho tunnel 2 như tunnel 1:</li>
</ol>
<h2 id="chèn-hình-4">chèn hình</h2>
<p>kết quả</p>
<h2 id="chèn-hình-5">chèn hình</h2>
<ol start="7">
<li>Cấu hình interface tunnel1,2</li>
<li>Trong giao diện cấu hình Fortigate:
<ul>
<li>Chọn Network -&gt;  Interface  WAN1 -&gt; Chon + -&gt; Chọn VPN AWS Tunnel 1 -&gt; Chọn Edit</li>
<li>IP nhập  169.254.52.6</li>
<li>Remote IP/Netmask nhập 169.254.52.5/30</li>
<li>Administrative Access chọn Ping</li>
<li>Status chọn Enable</li>
<li>Chọn OK</li>
</ul>
</li>
</ol>
<h2 id="chèn-hình-6">chèn hình</h2>
<p>cấu hình tunnel 2 tường tự</p>
<h2 id="chèn-hình-7">chèn hình</h2>
<ol start="8">
<li>Cấu hình routing BGP<br>
** Lưu ý ở bước các bạn dựa vào phần <strong>“#4: Border Gateway Protocol (BGP) Configuration”</strong> có trong nội dung file cấu hình đã tải trước đó**
<ul>
<li>Trong giao diện cấu hình Fortigate bạn cấu hình luôn routing cho cả 2 tunnel theo file:</li>
<li>Chọn Network -&gt; Chọn BGP</li>
<li>Router-ID nhập 118.107.96.13</li>
<li>Chọn Apply</li>
</ul>
</li>
</ol>
<h2 id="chèn-hình-8">chèn hình</h2>
<ul>
<li>Neighbor chọn Create new. Hộp Add Neighbor hiện ra để cấu hình tunnel 1</li>
</ul>
<h2 id="chèn-hình-9">chèn hình</h2>
<ul>
<li>Neighbor chọn Create new. Hộp Add Neighbor hiện ra để cấu hình tunnel 1,IP nhập 169.254.52.5, Remote AS nhập 64512</li>
</ul>
<h2 id="chèn-hình-10">chèn hình</h2>
<ul>
<li>IP/Netmask nhập 172.16.4.0/24. Đây là dải địa chỉ được Fortigate dùng để quảng bá cho AWS.</li>
</ul>
<p>** lưu ý ở chỗ này cấu hình khác với trong file **</p>
<h2 id="chèn-hình-11">chèn hình</h2>
<ol start="9">
<li>Cấu hình neighbors cho tunnel 2
<ul>
<li>Neighbors chọn Create New. Hộp Add Neighbor hiện ra để cấu hình tunnel 1</li>
<li>IP nhập 169.254.52.5, Remote AS nhập 64512 -&gt; Chọn OK</li>
<li>Chọn Apply</li>
</ul>
</li>
</ol>
<h2 id="chèn-hình-12">chèn hình</h2>
<ol start="10">
<li>Tạo các policy<br>
Mặc định Firewall sẽ chặn tất cả lưu lương mạng ở tất cả các cổng. Ở phần này bạn sẽ mở chính sách truy cập ở cả 2 chiều của VPN trên cả 2 tunnel<br>
** Lưu ý ở bước các bạn dựa vào phần #5: Firewall Policy Configuration” có trong nội dung file cấu hình đã tải trước đó.**<br>
<strong>Cấu hình mở chính sách truy cập VPN lên aws cho tunnel 1. Trong giao diện cấu hình Fortigate:</strong>
<ul>
<li>Chọn Policy &amp; Objects</li>
<li>Chọn Firewall Policy</li>
<li>Chọn Create New</li>
<li>Name nhập DC TO AWS Tunnel 1</li>
<li>Incoming Interface chọn LAN(Port6)</li>
<li>Outgoing Interface chọn VPN AWS Tunnel1</li>
<li>Source chọn All</li>
<li>Destination chọn All</li>
<li>Service chọn All</li>
<li>NAT chọn uncheck</li>
<li>Log Allowed Traffic chọn ALL Sessions. Để có ghi nhận lại nhật ký truy cập</li>
<li>Chọn OK</li>
</ul>
</li>
</ol>
<h2 id="chèn-hình-13">chèn hình</h2>
<ol start="11">
<li>Cấu hình mở chính sách truy cập từ AWS về DC cho tunnel 1. Trong giao diện cấu hình Fortigate:
<ul>
<li>Chọn Policy &amp; Objects</li>
<li>Chọn Firewall Policy</li>
<li>Chọn Create New</li>
<li>Name nhập AWS TO DC Tunnel 1</li>
<li>Incoming Interface chọn VPN AWS Tunnel1</li>
<li>Outgoing Interface chọn LAN(Port6)</li>
<li>Source chọn All</li>
<li>Destination chọn All</li>
<li>Service chọn All</li>
<li>NAT chọn uncheck</li>
<li>Log Allowed Traffic chọn ALL Sessions. Để có ghi nhận lại nhật ký truy cập</li>
<li>Chọn OK</li>
</ul>
</li>
</ol>
<h2 id="chèn-hình-14">chèn hình</h2>
<ol start="12">
<li>Cấu hình mở chính sách truy cập tương tự cho tunnel 2 ở 2 chiều. Ở phần này các bạn tự cấu hình tương tự sau khi xong bạn sẽ có tổng cộng 4 policy.</li>
</ol>
<h2 id="chèn-hình-15">chèn hình</h2>
<ol start="13">
<li>Kiểm tra tình trạng VPN<br>
Truy cập vào cloudwatchlog để xem log về phase 1 phase 2 của vpn
<ul>
<li>Tại giao diện cloudwatch , chọn Log groups, chọn vpns2s/log, chọn log 1 tunnel và kiểm tra trạng thái đã thiết lập VPN</li>
</ul>
</li>
</ol>
<h2 id="chèn-hình-16">chèn hình</h2>
<ol start="14">
<li>Kiểm tra trạng thái tunnel :
<ul>
<li>Trạng thái tunnel của vpn up trên Fortigate (chèn hình)</li>
<li>trạng thái vpn trên aws (chèn hình)</li>
<li>Kiểm tra bảng định tuyến
<ul>
<li>Kiểm tra bảng định tuyến (chèn hinh)</li>
<li>Trên giao diện Fortigate chọn Dashboard chọn +  nhập Routing rồi chọn + , sau đó chọn Add Monitor để tạo bảng monitor routing (chèn hình)</li>
<li>Dashboard chọn Routing Monitor xem sự xuất hiện của Subnet aws trên Fortigate (chèn hình)\</li>
</ul>
</li>
</ul>
</li>
</ol>
<blockquote>
<p>** lưu ý ở đây : mình chỉ thấy có 1 route duy nhất cho interface VPN AWS Tunnel1 do route mình đang xài dynamic nên cả 2 site Fortigate và AWS sẽ tự động hóa chọn 1 tunnel để truyền dữ liệu. Tunnel 2 sẽ ở trạng thái backup khi có downtime ở tunnel 1 trên aws **</p>
</blockquote>
<ol start="15">
<li>Kiểm tra tình trang VPN
<ul>
<li>Kiểm tra ping từ DC lên EC2 Private (chèn hình)</li>
<li>Kiểm tra ping từ Aws về PC ở DC (chen 2hinh)</li>
</ul>
</li>
</ol>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/3-configvpnonaws/3.8-c%E1%BA%A5u-h%C3%ACnh-site-to-site-on-fortogate/" title="Cấu hình S2S fortigate"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/3-configvpnonaws/3.8-c%E1%BA%A5u-h%C3%ACnh-site-to-site-on-fortogate/3.8.2-ki%E1%BB%83m-tra-vpn/" title="Dọn dẹp tài nguyên" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1724598897"></script>
    <script src="/js/perfect-scrollbar.min.js?1724598897"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1724598897"></script>
    <script src="/js/jquery.sticky.js?1724598897"></script>
    <script src="/js/featherlight.min.js?1724598897"></script>
    <script src="/js/highlight.pack.js?1724598897"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1724598897"></script>
    <script src="/js/learn.js?1724598897"></script>
    <script src="/js/hugo-learn.js?1724598897"></script>

    <link href="/mermaid/mermaid.css?1724598897" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1724598897"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
